# Historical Features Migration Plan

**Issue**: Features migrated to wrong location in Phase 6

**Problem**:

- Spec-kit uses: `specs/001-feature-name/spec.md` (root-level, directory per feature)
- We migrated to: `.specify/features/F001-feature-name.md` (flat files)
- Script `create-new-feature.sh` looks in `specs/` for highest number

**Impact**:

- New features start at `001` instead of continuing from `F026` → `027`
- Historical features not accessible to spec-kit workflow
- Breaking spec-kit conventions

---

## Solution: Move to `specs/` with proper structure

### Option A: Full Migration (Recommended)

Move all F001-F026 to `specs/` in spec-kit format:

```bash
# For each historical feature:
# F001-feature-name.md → specs/001-feature-name/spec.md

mkdir -p specs/001-entu-entity-types
mv .specify/features/F001-entu-entity-types.md specs/001-entu-entity-types/spec.md

# ... repeat for F002-F026
```

**Benefits**:

- ✅ Full spec-kit compliance
- ✅ Script auto-detects next number (027)
- ✅ Consistent structure for all features
- ✅ Can add plan.md, tasks.md per feature later

**Drawbacks**:

- More work (26 features to migrate)
- Changes git history paths

### Option B: Hybrid Approach

Keep historical features in `.specify/features/` as archive, start fresh at `specs/027`:

```bash
# Update script to start from 027
# Add comment in .specify/features/README.md:
# "Historical features F001-F026 archived here. Active development uses specs/ starting from 027."
```

**Benefits**:

- ✅ Less migration work
- ✅ Preserves historical location
- ✅ Clear separation: archive vs active

**Drawbacks**:

- ❌ Non-standard (spec-kit expects specs/)
- ❌ Numbering gap (001-026 missing)
- ❌ Confusion about where features live

### Option C: Update Script Only

Modify `create-new-feature.sh` to check both `.specify/features/` and `specs/`:

```bash
# Check .specify/features for F001-F026
# Check specs/ for 001+
# Use highest number +1
```

**Benefits**:

- ✅ Minimal disruption
- ✅ Works with current structure

**Drawbacks**:

- ❌ Custom script (diverges from upstream)
- ❌ Harder to sync updates
- ❌ Still non-standard structure

---

## Recommendation: Option A (Full Migration)

**Reasoning**:

1. Spec-kit integration goal is 100% structural compliance
2. We already customized content (templates), structure should match
3. Clean separation: `specs/` for features, `.specify/` for workflow
4. Makes future sync easier
5. 26 features is manageable (can script it)

**Migration Script** (complete, single file):

```bash
#!/bin/bash
# migrate-features.sh - Migrate historical F001-F026 to spec-kit specs/ structure

set -e

echo "Starting feature migration from .specify/features/ to specs/"

# Change to features directory
cd .specify/features

# Counter for tracking progress
count=0

# Migrate each F0*.md file
for file in F0*.md; do
    # Skip if not a file
    [ -f "$file" ] || continue
    
    # Extract number (F001 → 001, F010 → 010)
    num=$(echo "$file" | sed 's/F0*/0/' | sed 's/-.*//')
    num=$(printf "%03d" "$num")  # Ensure 3 digits
    
    # Extract name (F001-feature-name.md → feature-name)
    name=$(echo "$file" | sed 's/F[0-9]*-//' | sed 's/\.md$//')
    
    # Create spec directory
    mkdir -p "../../specs/$num-$name"
    
    # Copy file to spec.md (keep original for now)
    cp "$file" "../../specs/$num-$name/spec.md"
    
    count=$((count + 1))
    echo "[$count] Migrated: $file → specs/$num-$name/spec.md"
done

# Return to repo root
cd ../..

# Create specs README.md
cat > specs/README.md << 'EOF'
# Feature Specifications

This directory contains all feature specifications following spec-kit conventions.

## Structure

Each feature has its own directory:

```text
specs/
├── 001-feature-name/
│   ├── spec.md      # Feature specification
│   ├── plan.md      # Implementation plan (generated by /plan)
│   └── tasks.md     # Task breakdown (generated by /tasks)
├── 002-another-feature/
│   └── spec.md
└── README.md        # This file
```/text

## Historical Features

Features **001-026** were migrated from legacy `.copilot-workspace/features/` (F001-F026).

These are historical feature specifications from before spec-kit integration.

## New Features

Features **027+** are created using the spec-kit workflow:

```bash
/specify "Add new feature description"
```/bash

This command will:
1. Find the highest feature number (e.g., 026)
2. Create next number directory (e.g., `specs/027-feature-name/`)
3. Generate `spec.md` from template
4. Create feature branch `027-feature-name`

## Workflow

After creating a spec with `/specify`:

1. **Plan**: `/plan` generates `plan.md` in the feature directory
2. **Tasks**: `/tasks` generates `tasks.md` with implementation breakdown
3. **Implement**: `/implement` executes tasks and creates the feature

See `.specify/README.md` for complete workflow documentation.

---

**Note**: Original feature files remain in `.specify/features/` for reference until migration is confirmed successful.
EOF

echo ""
echo "✅ Migration complete!"
echo "   Migrated $count features to specs/"
echo "   Created specs/README.md"
echo ""
echo "Next steps:"
echo "1. Review specs/ directory structure"
echo "2. Test create-new-feature.sh (should create 027-*)"
echo "3. If successful, archive .specify/features/ to .specify/archive/"
```

**To run this script**:

```bash
# Save script to file
cat > .specify/scripts/migrate-features.sh << 'SCRIPT'
[paste script above]
SCRIPT

# Make executable
chmod +x .specify/scripts/migrate-features.sh

# Run migration
./.specify/scripts/migrate-features.sh
```

---

## Execution Plan

1. **Create migration script** (above)
2. **Run migration**: Move F001-F026 → specs/001-026
3. **Verify**: Check specs/ structure, test create-new-feature.sh
4. **Update .specify/features/README.md**: Note historical migration
5. **Test**: Run `/specify` again, should create `027-taskprioritybadge`
6. **Commit**: `refactor: Migrate historical features to spec-kit specs/ structure`

---

## Files to Update After Migration

- `.specify/CUSTOMIZATIONS.md`: Note specs/ vs .specify/features/
- `.specify/README.md`: Update feature location references
- `.specify/archive/README.md`: Note original location was .copilot-workspace/features/

---

**Decision Required**: Choose Option A, B, or C before proceeding with test.
